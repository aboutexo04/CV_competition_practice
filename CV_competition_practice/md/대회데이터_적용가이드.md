# ğŸ† ëŒ€íšŒ ë°ì´í„° ì ìš© ê°€ì´ë“œ

í˜„ì¬ CIFAR-10 ì—°ìŠµìš© ì½”ë“œë¥¼ ì‹¤ì œ ëŒ€íšŒ ë°ì´í„°ì— ì ìš©í•˜ëŠ” ë°©ë²•ì…ë‹ˆë‹¤.

## ğŸ“‹ ìˆ˜ì • í•„ìš”í•œ ë¶€ë¶„

### 1ï¸âƒ£ ë°ì´í„°ì…‹ í´ë˜ìŠ¤ ì¶”ê°€ (ìƒˆë¡œìš´ ì…€ ì¶”ê°€)

**ìœ„ì¹˜**: `## 5. ë°ì´í„°ì…‹ ë¡œë“œ` ì„¹ì…˜ ì•ì— ì¶”ê°€

```python
# ============================================
# ëŒ€íšŒìš© Custom Dataset í´ë˜ìŠ¤
# ============================================
import pandas as pd
from PIL import Image
import os

class CompetitionDataset(Dataset):
    """
    ëŒ€íšŒ ë°ì´í„°ìš© ì»¤ìŠ¤í…€ ë°ì´í„°ì…‹

    Args:
        image_dir: ì´ë¯¸ì§€ í´ë” ê²½ë¡œ
        labels_df: ë ˆì´ë¸” ë°ì´í„°í”„ë ˆì„ (trainìš©, testëŠ” None)
        transform: Albumentations transform
    """
    def __init__(self, image_dir, labels_df=None, transform=None):
        self.image_dir = image_dir
        self.labels_df = labels_df
        self.transform = transform

        # ì´ë¯¸ì§€ íŒŒì¼ ëª©ë¡
        if labels_df is not None:
            self.image_files = labels_df['image_id'].tolist()  # CSV ê¸°ì¤€
        else:
            self.image_files = sorted(os.listdir(image_dir))   # í´ë” ê¸°ì¤€

    def __len__(self):
        return len(self.image_files)

    def __getitem__(self, idx):
        img_name = self.image_files[idx]
        img_path = os.path.join(self.image_dir, img_name)

        # ì´ë¯¸ì§€ ë¡œë“œ
        image = Image.open(img_path).convert('RGB')
        image = np.array(image)

        # ë ˆì´ë¸” ê°€ì ¸ì˜¤ê¸°
        if self.labels_df is not None:  # Train
            label = self.labels_df[self.labels_df['image_id'] == img_name]['label'].values[0]
        else:  # Test
            label = -1  # placeholder

        # Transform ì ìš©
        if self.transform:
            augmented = self.transform(image=image)
            image = augmented['image']

        return image, label
```

### 2ï¸âƒ£ ë°ì´í„° ë¡œë”© ë¶€ë¶„ ìˆ˜ì •

**ìœ„ì¹˜**: `## 5. ë°ì´í„°ì…‹ ë¡œë“œ` ì„¹ì…˜

**ê¸°ì¡´ ì½”ë“œ (CIFAR-10):**
```python
train_dataset_raw = torchvision.datasets.CIFAR10(
    root='./data',
    train=True,
    download=True
)

test_dataset_raw = torchvision.datasets.CIFAR10(
    root='./data',
    train=False,
    download=True
)
```

**ë³€ê²½ í›„ (ëŒ€íšŒ ë°ì´í„°):**
```python
# ============================================
# ëŒ€íšŒ ë°ì´í„° ë¡œë“œ
# ============================================
import pandas as pd

# CSV íŒŒì¼ ë¡œë“œ
train_df = pd.read_csv('./data/train.csv')  # ê²½ë¡œ ìˆ˜ì • í•„ìš”
test_df = pd.read_csv('./data/test.csv')    # ìˆë‹¤ë©´

# ë ˆì´ë¸” ì¸ì½”ë”© (ë¬¸ìì—´ â†’ ìˆ«ì)
from sklearn.preprocessing import LabelEncoder
label_encoder = LabelEncoder()
train_df['label'] = label_encoder.fit_transform(train_df['label'])

# í´ë˜ìŠ¤ ê°œìˆ˜ í™•ì¸
num_classes = len(label_encoder.classes_)
print(f"ğŸ“Š í´ë˜ìŠ¤ ê°œìˆ˜: {num_classes}")
print(f"ğŸ“Š í´ë˜ìŠ¤ ëª©ë¡: {label_encoder.classes_}")

# ë°ì´í„°ì…‹ ìƒì„±
train_dataset_raw = CompetitionDataset(
    image_dir='./data/train_images',  # ê²½ë¡œ ìˆ˜ì • í•„ìš”
    labels_df=train_df,
    transform=None
)

test_dataset_raw = CompetitionDataset(
    image_dir='./data/test_images',   # ê²½ë¡œ ìˆ˜ì • í•„ìš”
    labels_df=None,
    transform=None
)

# ë ˆì´ë¸” ì¶”ì¶œ (K-Foldìš©)
train_labels = train_df['label'].tolist()
```

**âš ï¸ ê²½ë¡œ ìˆ˜ì • í•„ìˆ˜:**
- `./data/train.csv` â†’ ì‹¤ì œ train CSV ê²½ë¡œ
- `./data/train_images` â†’ ì‹¤ì œ train ì´ë¯¸ì§€ í´ë” ê²½ë¡œ
- `./data/test_images` â†’ ì‹¤ì œ test ì´ë¯¸ì§€ í´ë” ê²½ë¡œ

### 3ï¸âƒ£ ëª¨ë¸ í´ë˜ìŠ¤ ê°œìˆ˜ ìˆ˜ì •

**ìœ„ì¹˜**: K-Fold í•™ìŠµ ë£¨í”„ ë‚´ (Cell 16)

**ê¸°ì¡´ ì½”ë“œ:**
```python
model = timm.create_model(SELECTED_MODEL, pretrained=True, num_classes=10)
```

**ë³€ê²½ í›„:**
```python
model = timm.create_model(SELECTED_MODEL, pretrained=True, num_classes=num_classes)
```

### 4ï¸âƒ£ í´ë˜ìŠ¤ ì´ë¦„ ìˆ˜ì •

**ìœ„ì¹˜**: ì•™ìƒë¸” ì˜ˆì¸¡ í›„ (Cell 19 í•˜ë‹¨)

**ê¸°ì¡´ ì½”ë“œ:**
```python
class_names = ['airplane', 'automobile', 'bird', 'cat', 'deer',
               'dog', 'frog', 'horse', 'ship', 'truck']
```

**ë³€ê²½ í›„:**
```python
# ëŒ€íšŒ í´ë˜ìŠ¤ ì´ë¦„ ì‚¬ìš©
class_names = label_encoder.classes_.tolist()
```

### 5ï¸âƒ£ USE_SUBSET ì„¤ì • ë³€ê²½

**ìœ„ì¹˜**: `## 5. ë°ì´í„°ì…‹ ë¡œë“œ` ì„¹ì…˜ (Cell 13)

**ì—°ìŠµìš©:**
```python
USE_SUBSET = True   # 10% ë°ì´í„° ì‚¬ìš©
SUBSET_RATIO = 0.1
```

**ëŒ€íšŒ ì œì¶œìš©:**
```python
USE_SUBSET = False  # ì „ì²´ ë°ì´í„° ì‚¬ìš© â­â­â­
SUBSET_RATIO = 1.0
```

---

## ğŸ“Š ëŒ€íšŒ ë°ì´í„° êµ¬ì¡° ì˜ˆì‹œ

ëŒ€íšŒ ë°ì´í„°ê°€ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¼ê³  ê°€ì •:

```
data/
â”œâ”€â”€ train.csv              # image_id, label ì»¬ëŸ¼
â”œâ”€â”€ test.csv               # image_id ì»¬ëŸ¼ (ë ˆì´ë¸” ì—†ìŒ)
â”œâ”€â”€ train_images/          # í•™ìŠµ ì´ë¯¸ì§€ í´ë”
â”‚   â”œâ”€â”€ img_001.jpg
â”‚   â”œâ”€â”€ img_002.jpg
â”‚   â””â”€â”€ ...
â””â”€â”€ test_images/           # í…ŒìŠ¤íŠ¸ ì´ë¯¸ì§€ í´ë”
    â”œâ”€â”€ test_001.jpg
    â”œâ”€â”€ test_002.jpg
    â””â”€â”€ ...
```

**train.csv ì˜ˆì‹œ:**
```csv
image_id,label
img_001.jpg,cat
img_002.jpg,dog
img_003.jpg,cat
```

---

## âœ… ìˆ˜ì • ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] CompetitionDataset í´ë˜ìŠ¤ ì¶”ê°€
- [ ] ë°ì´í„° ë¡œë”© ì½”ë“œ ìˆ˜ì • (CSV ê²½ë¡œ, ì´ë¯¸ì§€ í´ë” ê²½ë¡œ)
- [ ] LabelEncoderë¡œ ë ˆì´ë¸” ì¸ì½”ë”©
- [ ] num_classes ë³€ìˆ˜ ìƒì„± ë° ì ìš©
- [ ] class_namesë¥¼ label_encoder.classes_ë¡œ ë³€ê²½
- [ ] USE_SUBSET = Falseë¡œ ë³€ê²½ (ì „ì²´ ë°ì´í„° ì‚¬ìš©)
- [ ] Image Size í™•ì¸ (ëŒ€íšŒ ì´ë¯¸ì§€ í¬ê¸°ì— ë§ê²Œ ì¡°ì •)

---

## ğŸš€ ì‹¤í–‰ ìˆœì„œ

1. **ëŒ€íšŒ ë°ì´í„° ë‹¤ìš´ë¡œë“œ** â†’ `data/` í´ë”ì— ë°°ì¹˜
2. **ìœ„ ìˆ˜ì •ì‚¬í•­ ì ìš©** â†’ 5ê°œ ë¶€ë¶„ë§Œ ìˆ˜ì •
3. **ì´ë¯¸ì§€ í¬ê¸° í™•ì¸** â†’ `IMAGE_SIZE` ë³€ìˆ˜ ì¡°ì • (í•„ìš”ì‹œ)
4. **USE_SUBSET = False** â†’ ì „ì²´ ë°ì´í„°ë¡œ í•™ìŠµ
5. **í•™ìŠµ ì‹¤í–‰** â†’ ë‚˜ë¨¸ì§€ ì½”ë“œëŠ” ê·¸ëŒ€ë¡œ ì‚¬ìš©!

---

## ğŸ’¡ ì¶”ê°€ íŒ

### ì´ë¯¸ì§€ í¬ê¸° ìµœì í™”
ëŒ€íšŒ ì´ë¯¸ì§€ í¬ê¸° í™•ì¸ í›„ ì„¤ì •:
```python
IMAGE_SIZE = 224  # EfficientNet ê¶Œì¥
IMAGE_SIZE = 384  # ê³ í•´ìƒë„ í•„ìš”ì‹œ
```

### ë°°ì¹˜ í¬ê¸° ì¡°ì •
ë©”ëª¨ë¦¬ì— ë§ê²Œ ì¡°ì •:
```python
BATCH_SIZE = 32   # ì•ˆì „í•œ í¬ê¸°
BATCH_SIZE = 16   # ë©”ëª¨ë¦¬ ë¶€ì¡±ì‹œ
```

### ì œì¶œ íŒŒì¼ ìƒì„±
í…ŒìŠ¤íŠ¸ ì˜ˆì¸¡ í›„ ì œì¶œ íŒŒì¼ ìƒì„±:
```python
# ì œì¶œ íŒŒì¼ ìƒì„±
submission = pd.DataFrame({
    'image_id': test_dataset_raw.image_files,
    'label': label_encoder.inverse_transform(ensemble_preds)
})
submission.to_csv('submission.csv', index=False)
print("âœ… submission.csv ìƒì„± ì™„ë£Œ!")
```

---

## â“ ë¬¸ì œ í•´ê²°

### Q1: ì´ë¯¸ì§€ ë¡œë”© ì—ëŸ¬
```python
# RGBë¡œ ê°•ì œ ë³€í™˜
image = Image.open(img_path).convert('RGB')
```

### Q2: ë©”ëª¨ë¦¬ ë¶€ì¡±
```python
# ë°°ì¹˜ í¬ê¸° ì¤„ì´ê¸°
BATCH_SIZE = 16

# num_workers ì¡°ì •
num_workers = 2  # ë˜ëŠ” 0
```

### Q3: í´ë˜ìŠ¤ ë¶ˆê· í˜•
```python
# Weighted Loss ì‚¬ìš©
from torch.utils.data import WeightedRandomSampler
class_counts = train_df['label'].value_counts().sort_index().values
class_weights = 1.0 / class_counts
```

---

**ğŸ¯ ì´ ê°€ì´ë“œëŒ€ë¡œ ìˆ˜ì •í•˜ë©´ ë°”ë¡œ ëŒ€íšŒ ë°ì´í„°ë¡œ í•™ìŠµ ê°€ëŠ¥í•©ë‹ˆë‹¤!**
